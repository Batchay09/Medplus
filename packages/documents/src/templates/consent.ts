import type { Patient, Service } from '@medplus/db';
import { formatDate } from './styles';

/**
 * Returns the text content for the informed consent form.
 */
export function getConsentContent(
  patient: Patient,
  service: Service
): { title: string; sections: { heading: string; body: string }[] } {
  const today = formatDate(new Date().toISOString());

  const risksByCategory: Record<string, string> = {
    iv_drip:
      'возможные побочные эффекты: местная реакция в месте введения (покраснение, отёк), аллергические реакции, головокружение, изменение артериального давления',
    injection:
      'возможные побочные эффекты: боль в месте инъекции, гематома, аллергические реакции',
    bandage:
      'возможные побочные эффекты: раздражение кожи, аллергическая реакция на материалы',
    blood_test:
      'возможные побочные эффекты: гематома в месте пункции, кратковременное головокружение',
    package:
      'возможные побочные эффекты определяются составом пакета процедур',
  };

  return {
    title: 'ИНФОРМИРОВАННОЕ ДОБРОВОЛЬНОЕ СОГЛАСИЕ',
    sections: [
      {
        heading: '',
        body: `г. Черкесск                                                                    ${today}`,
      },
      {
        heading: 'Я, нижеподписавшийся(аяся)',
        body: `${patient.full_name}, дата рождения: ${patient.birth_date ? formatDate(patient.birth_date) : 'не указана'},\n\nдаю информированное добровольное согласие на проведение следующей медицинской процедуры:`,
      },
      {
        heading: 'Процедура',
        body: `${service.name}\nПродолжительность: ~${service.duration_minutes} мин.`,
      },
      {
        heading: 'Информация о процедуре',
        body: `Мне разъяснены:\n  - цель и характер предстоящей процедуры;\n  - ${risksByCategory[service.category] || 'возможные побочные эффекты'};\n  - необходимость сообщить медицинскому работнику об имеющихся аллергиях и хронических заболеваниях.`,
      },
      {
        heading: 'Аллергии / Противопоказания',
        body: patient.allergies || 'Не указаны',
      },
      {
        heading: 'Подтверждение',
        body: `Я подтверждаю, что:\n  - получил(а) исчерпывающую информацию о процедуре;\n  - имел(а) возможность задать вопросы и получить ответы;\n  - добровольно даю согласие на проведение указанной процедуры;\n  - уведомлён(а) о праве отказаться от процедуры в любой момент.\n\n\nПодпись пациента: _______________          Дата: ${today}\n\nМедсестра: _______________`,
      },
    ],
  };
}
