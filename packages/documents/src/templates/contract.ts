import type { Patient, Order, Service } from '@medplus/db';
import { formatDate, formatMoney } from './styles';

/**
 * Returns the text content for the service contract.
 */
export function getContractContent(
  patient: Patient,
  order: Order,
  service: Service
): { title: string; sections: { heading: string; body: string }[] } {
  const today = formatDate(new Date().toISOString());

  return {
    title: 'ДОГОВОР НА ОКАЗАНИЕ МЕДИЦИНСКИХ УСЛУГ',
    sections: [
      {
        heading: '',
        body: `г. Черкесск                                                                    ${today}\n\nИП "МедПлюс", именуемый в дальнейшем "Исполнитель", с одной стороны, и ${patient.full_name}, именуемый(ая) в дальнейшем "Заказчик", с другой стороны, заключили настоящий Договор о нижеследующем:`,
      },
      {
        heading: '1. ПРЕДМЕТ ДОГОВОРА',
        body: `1.1. Исполнитель обязуется оказать Заказчику медицинскую услугу: "${service.name}".\n1.2. Место оказания услуги: ${order.address}.\n1.3. Дата оказания услуги: ${formatDate(order.requested_date)}.\n1.4. Ориентировочная продолжительность: ${service.duration_minutes} мин.`,
      },
      {
        heading: '2. СТОИМОСТЬ УСЛУГ И ПОРЯДОК РАСЧЁТОВ',
        body: `2.1. Стоимость услуги составляет ${formatMoney(order.service_price)}.\n2.2. Стоимость расходных материалов: ${formatMoney(order.supplies_cost)}.\n2.3. Дополнительные сборы (срочность/ночное время): ${formatMoney(order.surcharge)}.\n2.4. Итого к оплате: ${formatMoney(order.total_price)}.\n2.5. Оплата производится ${order.payment_method === 'cash' ? 'наличными' : 'переводом на карту'} по факту оказания услуги.`,
      },
      {
        heading: '3. ОБЯЗАННОСТИ СТОРОН',
        body: `3.1. Исполнитель обязуется:\n  - направить квалифицированную медицинскую сестру;\n  - обеспечить качественное оказание услуги;\n  - соблюдать санитарные нормы и правила.\n\n3.2. Заказчик обязуется:\n  - обеспечить доступ по указанному адресу;\n  - предоставить достоверную информацию о состоянии здоровья;\n  - произвести оплату в установленном порядке.`,
      },
      {
        heading: '4. ОТВЕТСТВЕННОСТЬ СТОРОН',
        body: `4.1. Стороны несут ответственность за неисполнение обязательств в соответствии с законодательством РФ.\n4.2. Исполнитель не несёт ответственности за последствия, возникшие по причине предоставления Заказчиком недостоверной информации.\n4.3. Политика отмены: бесплатная отмена за 3 часа и более. При отмене менее чем за 3 часа — компенсация 30% стоимости.`,
      },
      {
        heading: '5. РЕКВИЗИТЫ И ПОДПИСИ',
        body: `Исполнитель:                              Заказчик:\nИП "МедПлюс"                              ${patient.full_name}\nг. Черкесск                                Тел: ${patient.phone}\n\n\n_______________                            _______________\n    (подпись)                                  (подпись)`,
      },
    ],
  };
}
